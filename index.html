<html lang="pl">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>Memory - gra pamiÄ™ciowa</title>
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" type="text/css" href="style.css">
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	
</head>

<body>

<div class="plansza"><table id="plansza_tab"></table></div>

<script>

	var MyArray = [];
	var plate = [];
	
	var row = 4;
	var col = 4;
	
	var xmlhttp = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			myFunction(this);
			shuffle(MyArray);
			var len_ = (row*col)/2;
			var nr = 0;
			var table="<tr>";
			MyArray.splice(0, 8);
			for (i = 0; i <len_; i++) {
				table += "<td id='img_"+nr+"'><img class='hid' src='" + MyArray[i] + "'></td>";
				nr++;
				if((i+1)%col==0){
					table+="</tr><tr>";
				}
			}
			shuffle(MyArray);
			for (i = 0; i <len_; i++) {
				table += "<td id='img_"+nr+"'><img class='hid' src='" + MyArray[i] + "'></td>";
				nr++;
				if((i+1)%col==0){
					table+="</tr><tr>";					
				}
			}
			document.getElementById("plansza_tab").innerHTML = table.substr(0,(table.length-4));
		}
	};
	xmlhttp.open("GET","dane.xml",true);
	xmlhttp.send();
	
	function myFunction(xml) {
		var i;
		var xmlDoc = xml.responseXML;		
		var x = xmlDoc.getElementsByTagName("plate");
		for (i = 0; i <x.length; i++) {
			MyArray.push(x[i].getElementsByTagName("link")[0].childNodes[0].nodeValue);
		}
	}
	
	function shuffle(a) {
		for (let i = a.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[a[i], a[j]] = [a[j], a[i]];
		}
	}
	
	


</script>


<script>

var score = 0;
var plate = [];
$(document).ready(function(){
    $("td").click(function(){
		if(plate.length==0){
			plate.push($(this));
			InvertPlate($(this),1);
		}
		if(plate.length==1 && plate[0].attr("id") != $(this).attr("id")){
			plate.push($(this));
			InvertPlate($(this),1);
			setTimeout(function(){ 
				if(plate[0].find("img").attr("src")==plate[1].find("img").attr("src") && plate[0].attr("id")!=plate[1].attr("id")){
					InvertPlate($("#"+plate[0].attr("id")),3);
					InvertPlate($("#"+plate[1].attr("id")),3);
				}
				InvertPlate($("#"+plate[0].attr("id")),2);
				InvertPlate($("#"+plate[1].attr("id")),2);				
				plate = [];
				score+=10;
			}, 1000);				
		}
		
		function InvertPlate(div_,st){
			switch(st) {
				case 1:
					div_.css( "background-color", "orange");		
					div_.find("img").css( "visibility", "visible" );	
					break;
				case 2:
					div_.css( "background-color", "silver");		
					div_.find("img").css( "visibility", "hidden" );	
					break;
				case 3:
					div_.css("visibility","hidden");		
					div_.find("img").removeClass("hid");
					break;
				default:
			}
		}
    });
});
</script>

</body>
</html>
